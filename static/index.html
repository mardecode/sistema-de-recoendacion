<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  </head>

  <body>


        <nav>
        <div class="nav-wrapper">
            <a href="#" class="brand-logo center">Sistema de Recomendaci√≥n</a>
        </div>
        </nav>
        

        <!-- end barra -->
        <div class="container">
            
            <div class="row" style="padding-top:30px">
                <form class="col" onsubmit="submitForm(event, this)">
                    <div class="row">
                        <div class="input-field col l2">
                            <input placeholder="Id user" id="first_name" name="iduser" class="validate" type="number" required>
                            <label for="first_name">ID User</label>
                        </div>
    
                        <div class="input-field col l3">
                                <select name="distancia" required>
                                  <option value="" disabled selected>Elija la distancia: </option>
                                  <option value="1">Manhattam</option>
                                  <option value="2">Euclidiana</option>
                                  <option value="3">Pearson</option>
                                  <option value="4">Soft Coseno</option>
                                </select>
                                <label>Seleccione distancia</label>
                        </div>
    
                        <div class="input-field col l2">
                                <input placeholder="k" id="first_name"  class="validate" type="number" name="k" required>
                                <label for="first_name">Num Vecinos</label>
                        </div>
    
                        <div class="input-field col l5">
                            <button class="btn waves-effect waves-light col s3" type="submit" name="submit" >KNN
                                    <i class="material-icons right">send</i>
                            </button>
                        </div>
    
                    </div>
                </form>
            </div>
        </div>
        
        <div class="container" id="app">
          <div v-if="datos">
            <div v-if="datos.error">
              {{datos.error}}
            </div>
            <div v-else>
                <table>
                    <thead>
                      <tr>
                          <th>Numero</th>
                          <th>idUser</th>
                          <th>Rating</th>
                      </tr>
                    </thead>
            
                    <tbody>
                      <tr v-for="(index,user) in datos.users">
                        <td>index</td>
                        <td>user.id</td>
                        <td>user.rating</td>
                      </tr>
                    </tbody>
                  </table>
            </div>
          </div>
          
        </div>

    <script>



    
    document.addEventListener('DOMContentLoaded', function() {
      var elems = document.querySelectorAll('select');
      var instances = M.FormSelect.init(elems);
    });

    function submitForm(e, form){
      e.preventDefault();
      //var formu = form.;
      console.log(form.k.value);
      
      fetch('http://localhost:9080/knn', {
        method: 'post',
        body: JSON.stringify({iduser: Number(form.iduser.value), distancia: Number(form.distancia.value) ,k:Number(form.k.value)})
      }).then(function(response) {
        return response.json();
      }).then(function(data) {
        //Success code goes here
        //alert('form submited')
        app.datos = data; 
        console.log(data);
      }).catch(function(err) {
        //Failure
        //alert('Error')
        console.log("Error: ");
        console.log(err);
      });
    }

    var app = new Vue({
      el: '#app',
      data: {
        datos: false
      }
    });

  </script>

    <!--JavaScript at end of body for optimized loading-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  </body>
</html>
      